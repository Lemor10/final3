<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Owner Panel{% endblock %}</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  {% block styles %}{% endblock %}
</head>
<body>

  {% include "navbar_owner.html" %}

  <main class="container mt-4">
    {% block content %}{% endblock %}
  </main>

<script>
document.addEventListener("DOMContentLoaded", function () {

  async function updateNotifDot() {
    const res = await fetch('{{ url_for("notification_count") }}');
    const data = await res.json();
    const dot = document.getElementById('notif-dot');
    if (!dot) return;

    if (data.count > 0) {
      dot.classList.remove('d-none');
    } else {
      dot.classList.add('d-none');
    }
  }

  updateNotifDot();
  setInterval(updateNotifDot, 30000);

  document.querySelectorAll('.notif-item').forEach(item => {
    item.addEventListener('click', async () => {
      const notifId = item.dataset.id;

      const res = await fetch(`/notifications/read/${notifId}`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token() if csrf_token else "" }}'
        }
      });

      if (res.ok) {
        item.querySelector('.badge')?.remove();
        item.classList.remove('fw-bold');
        updateNotifDot();
      }
    });
  });

});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</body>
</html>
